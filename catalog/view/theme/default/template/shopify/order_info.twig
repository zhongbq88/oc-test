{{ header }}
<div id="account-order" class="container">
 
  {% if success %}
  <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
    <button type="button" class="close" data-dismiss="alert">&times;</button>
  </div>
  {% endif %}
  {% if error_warning %}
  <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
    <button type="button" class="close" data-dismiss="alert">&times;</button>
  </div>
  {% endif %}
  <div class="row">
    <div id="content" class="{{ class }}">{{ content_top }}
      <h2>{{ heading_title }}</h2>
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <td class="text-left" colspan="2">{{ text_order_detail }}</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" style="width: 50%;">{% if invoice_no %} <b>{{ text_invoice_no }}</b> {{ invoice_no }}<br />
              {% endif %} <b>{{ text_order_id }}</b> #{{ sale_order_id }}<br />
              <b>{{ text_date_added }}</b> {{ date_added }}</td>
            <td class="text-left" style="width: 50%;">{% if payment_method %} <b>{{ text_payment_method }}</b> {{ payment_method }}<br />
              {% endif %}
              {% if shipping_method %} <b>{{ text_shipping_method }}</b> {{ shipping_method }} {% endif %}</td>
          </tr>
        </tbody>
      </table>
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <td class="text-left" style="width: 50%; vertical-align: top;">{{ text_payment_address }}</td>
            {% if shipping_address %}
            <td class="text-left" style="width: 50%; vertical-align: top;">{{ text_shipping_address }}</td>
            {% endif %} </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left">{{ payment_address }}</td>
            {% if shipping_address %}
            <td class="text-left">{{ shipping_address }}</td>
            {% endif %} </tr>
        </tbody>
      </table>
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <td class="text-left">{{ column_name }}</td>
              <td class="text-left">{{ column_model }}</td>
              <td class="text-right">{{ column_quantity }}</td>
              <td class="text-right">{{ column_price }}</td>
              <td class="text-right">{{ column_total }}</td>
              <td class="text-right">{{ column_sale_price }}</td>
              <!--{% if products %}
              <td style="width: 20px;"></td>
              {% endif %} --></tr>
          </thead>
          <tbody>
          
          {% for product in products %}
          <tr>
            <td class="text-left">
            <div style="float:left">{{ product.name }}
              {% for option in product.option %} <br />
              &nbsp;<small>{{ option.value }}</small> {% endfor %}</div>
             {% if product.design_file %}
              <div style="float: right"><a class="thumbnail" style="border:none;"><img src="{{  product.design_file }}"   style="width: auto; height: 120px;" /></a></div>
              {% endif %}
              </td>
            <td class="text-left">{{ product.model }}</td>
            <td class="text-left"><div class="input-group btn-block" style="max-width: 200px;">
                  <input type="text" {% if order_status_id!=1 %} disabled {% endif %} name="quantity[{{ product.order_product_id }}]" value="{{ product.quantity }}" size="1" class="form-control" />
                  <span class="input-group-btn">
                  <button type="button" {% if  order_status_id!=1 %} disabled {% endif %} data-toggle="tooltip" onclick="update('{{ product.order_product_id }}',this);" title="{{ button_update }}" {% if order_status_id!=1 %} disabled {% endif %} class="btn btn-primary"><i class="fa fa-refresh"></i></button>
                  <button type="button" {% if order_status_id!=1 %} disabled {% endif %} data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger" onclick="updateOrderProduct('{{ product.order_product_id }}',0);"><i class="fa fa-times-circle"></i></button>
                  </span></div></td>
            <td class="text-right">{{ product.price }}</td>
            <td class="text-right">{{ product.total }}</td>
            <td class="text-right">{{ product.sale_total }}</td>
            <!--<td class="text-right" style="white-space: nowrap;">{% if product.reorder %} <a href="{{ product.reorder }}" data-toggle="tooltip" title="{{ button_reorder }}" class="btn btn-primary"><i class="fa fa-shopping-cart"></i></a> {% endif %} <a href="{{ product.return }}" data-toggle="tooltip" title="{{ button_return }}" class="btn btn-danger"><i class="fa fa-reply"></i></a></td>-->
          </tr>
          {% endfor %}
          {% for voucher in vouchers %}
          <tr>
            <td class="text-left">{{ voucher.description }}</td>
            <td class="text-left"></td>
            <td class="text-right">1</td>
            <td class="text-right">{{ voucher.amount }}</td>
            <td class="text-right">{{ voucher.amount }}</td>
            <td></td>
            <!--{% if products %}
            <td></td>
            {% endif %}--> </tr>
          {% endfor %}
            </tbody>
          
          <tfoot>
          
          {% for total in totals %}
          <tr>
            <td colspan="3"></td>
            <td class="text-right"><b>{{ total.title }}</b></td>
            <td class="text-right">{{ total.text }}</td>
             <td class="text-right">{{ total.text2 }}</td>
          
            <!--{% if products %}
            <td></td>
            {% endif %}--> </tr>
          {% endfor %}
            </tfoot>
          
        </table>
      </div>
      {% if comment %}
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <td class="text-left">{{ text_comment }}</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left">{{ comment }}</td>
          </tr>
        </tbody>
      </table>
      {% endif %}
    <!--  {% if histories %}
      <h3>{{ text_history }}</h3>
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <td class="text-left">{{ column_date_added }}</td>
            <td class="text-left">{{ column_status }}</td>
            <td class="text-left">{{ column_comment }}</td>
          </tr>
        </thead>
        <tbody>
        
        {% if histories %}
        {% for history in histories %}
        <tr>
          <td class="text-left">{{ history.date_added }}</td>
          <td class="text-left">{{ history.status }}</td>
          <td class="text-left">{{ history.comment }}</td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="3" class="text-center">{{ text_no_results }}</td>
        </tr>
        {% endif %}
          </tbody>
        
      </table>
      {% endif %}-->
      <div class="buttons clearfix">
      	{% if order_status_id==1 %}
         <div class="pull-right"><a href="{{ paid }}"  class="btn btn-danger">{{ text_paid }}</a></div>
        {% else %}
        <div class="pull-right"><a href="{{ continue }}" class="btn btn-primary">{{ button_continue }}</a></div>
        {% endif %}
      </div>
      {{ content_bottom }}</div>
    {{ column_right }}</div>
</div>

  <script type="text/javascript"><!--
  function update(order_product_id,node){
	  var node2 = $(node).parent().parent().find('input[name^=\'quantity\']');
	  alert($(node2).val());
	  updateOrderProduct(order_product_id,$(node2).val());
  }
  
  function updateOrderProduct(order_product_id,quantity){
	  var formData =  new FormData();
	  formData.append("quantity",quantity);
	  formData.append("order_product_id",order_product_id);
	  $.ajax({
				url: 'index.php?route=shopify/orders/update',
				type: 'post',
				data: formData,
				dataType: 'json',
				cache: false,
				contentType: false,
				processData: false,
				success: function(json) {
					alert(json);
					/*if (json['success']) {
						window.location.href="index.php?route=extension/payment/pp_express/checkout";
					}*/
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
  }
   $('#form-order #button-update').on('click', function() {
	  var node = $(this).parent().parent().find('input[name^=\'quantity\']');
	  var formData =  new FormData();
	  formData.append("quantity",$(node).val());
	  formData.append("order_id",$(node).attr("data-id"));
	  $.ajax({
				url: 'index.php?route=shopify/orders/update',
				type: 'post',
				data: formData,
				dataType: 'json',
				cache: false,
				contentType: false,
				processData: false,
				success: function(json) {
					alert(json);
					/*if (json['success']) {
						window.location.href="index.php?route=extension/payment/pp_express/checkout";
					}*/
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
  });
  //--></script> 
{{ footer }}